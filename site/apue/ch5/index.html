<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/apue/ch5/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Chapter 5. Standard I/O Library - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                    
                        <li >
                            <a href="../ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                    
                        <li >
                            <a href="../ch3/">Chapter 3. File I/O</a>
                        </li>
                    
                        <li >
                            <a href="../ch4/">Chapter 4. Files and Directories</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Chapter 5. Standard I/O Library</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UTLK <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../utlk/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../utlk/ch2/">Chapter 2. Memory Addressing</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">ICND <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../icnd1/part1/">ICND1 Part I: Networking Fundamentals</a>
                        </li>
                    
                        <li >
                            <a href="../../icnd2/part1/">ICND2 Part I: LAN Switching</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">HTAE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../htae/ch2/">0x200 Programming</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../golang/">Go</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Others <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../bash/">Bash</a>
                        </li>
                    
                        <li >
                            <a href="../../c/">C</a>
                        </li>
                    
                        <li >
                            <a href="../../iptables/">iptables</a>
                        </li>
                    
                        <li >
                            <a href="../../nginx/">Nginx</a>
                        </li>
                    
                        <li >
                            <a href="../../vim/">Vim</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../ch4/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../utlk/ch1/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/shichao-an/notes">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-5-standard-io-library">Chapter 5. Standard I/O Library</a></li>
        
            <li><a href="#streams-and-file-objects">Streams and FILE Objects</a></li>
        
            <li><a href="#standard-input-standard-output-and-standard-error">Standard Input, Standard Output, and Standard Error</a></li>
        
            <li><a href="#buffering">Buffering</a></li>
        
            <li><a href="#doubts-and-solutions">Doubts and Solutions</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="chapter-5-standard-io-library">Chapter 5. Standard I/O Library</h2>
<p>The standard I/O library handles such details as buffer allocation and performing I/O in optimal-sized chunks.</p>
<h3 id="streams-and-file-objects">Streams and <code>FILE</code> Objects</h3>
<p>Standard I/O file streams can be used with both <strong>single-byte</strong> and <strong>multibyte</strong> ("wide") character sets. A stream’s orientation determines whether the characters that are read and written are single byte or multibyte. </p>
<ul>
<li>This book deals only with <strong>byte-oriented</strong> (single byte) streams.</li>
<li>This book refers to a pointer to a <code>FILE</code> object, the type <code>FILE *</code>, as a <em>file pointer</em>.</li>
</ul>
<h3 id="standard-input-standard-output-and-standard-error">Standard Input, Standard Output, and Standard Error</h3>
<p>Three streams are predefined and automatically available to a process. They refer to file descriptors <code>STDIN_FILENO</code>, <code>STDOUT_FILENO</code>, and <code>STDERR_FILENO</code> (defined in <code>&lt;unistd.h&gt;</code>) [p9]. These three standard I/O streams are referenced through the predefined file pointers <code>stdin</code>, <code>stdout</code>,and <code>stderr</code>(defined in <code>&lt;stdio.h&gt;</code>).</p>
<h3 id="buffering">Buffering</h3>
<ol>
<li><strong>Fully buffered</strong></li>
<li><strong>Line buffered</strong></li>
<li><strong>Unbuffered</strong></li>
</ol>
<p>Most implementations default to the following types of buffering:</p>
<ul>
<li>Standard error is always unbuffered.</li>
<li>All other streams are line buffered if they refer to a terminal device; otherwise, they are fully buffered.</li>
</ul>
<script src="https://gist.github.com/shichao-an/70e28ba25f1b7276e834.js"></script>

<ul>
<li><code>setbuf</code>: <em>buf</em> must point to a buffer of length <code>BUFSIZ</code>, a constant defined in <code>&lt;stdio.h&gt;</code></li>
<li><code>setvbuf</code>: type of buffering is specified with <code>_IOFBF</code>, <code>_IOLBF</code>, <code>_IONBF</code>.</li>
</ul>
<p>The GNU C librarys use the value from the <code>st_blksize</code> member of the <code>stat</code> structure to determine the optimal standard I/O buffer size.</p>
<p>The <code>fflush</code> function causes any unwritten data for the stream to be passed to the kernel. If <strong>fp</strong> is <code>NULL</code>, <code>fflush</code> causes all output streams to be flushed.</p>
<script src="https://gist.github.com/shichao-an/3fea32272cd9e1b574c6.js"></script>

<ul>
<li><code>fdopen</code> function is often used with descriptors returned by the functions that create pipes and network communication channels, because these special types of files cannot be opened with the <code>fopen</code> function.</li>
</ul>
<p><strong>type</strong> argument has 15 values as specifed by ISO C:</p>
<table>
<thead>
<tr>
<th><strong>type</strong></th>
<th>Description</th>
<th><code>open</code>(2) Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>r</code>, <code>rb</code></td>
<td>open for reading</td>
<td><code>O_RDONLY</code></td>
</tr>
<tr>
<td><code>w</code>, <code>wb</code></td>
<td>truncate to 0 length or create for writing</td>
<td><code>O_WRONLY&#124;O_CREAT&#124;O_TRUNC</code></td>
</tr>
<tr>
<td><code>a</code>, <code>ab</code></td>
<td>append; open for writing at end of file, or create for writing</td>
<td><code>O_WRONLY&#124;O_CREAT&#124;O_APPEND</code></td>
</tr>
<tr>
<td><code>r+</code>, <code>r+b</code>, <code>rb+</code></td>
<td>open for reading and writing</td>
<td><code>O_RDWR</code></td>
</tr>
<tr>
<td><code>w+</code>, <code>w+b</code>, <code>wb+</code></td>
<td>truncate to 0 length or create for reading and writing</td>
<td><code>O_RDWR&#124;O_CREAT&#124;O_TRUNC</code></td>
</tr>
<tr>
<td><code>a+</code>, <code>a+b</code>, <code>ab+</code></td>
<td>open or create for reading and writing at end of file</td>
<td><code>O_RDWR&#124;O_CREAT&#124;O_APPEND</code></td>
</tr>
</tbody>
</table>
<p>Character <code>b</code> allows the standard I/O system to differentiate between a text file and a binary file. The UNIX kernel doesn’t differentiate between these types of files, thus character <code>b</code> has no effect.</p>
<ul>
<li><strong>Write</strong>: The <code>fdopen</code> function cannot truncate any file it opens for writing</li>
<li><strong>Append</strong>: each write will take place at the then current end of file. If multiple processes open the same file with the standard I/O append mode, the data from each process will be correctly written to the file</li>
<li><strong>Read and write</strong> (<code>+</code> sign in type): Output cannot be directly followed by input without an intervening <code>fflush</code>, <code>fseek</code>, <code>fsetpos</code>, or <code>rewind</code>. Input cannot be directly followed by output without an intervening <code>fseek</code>, <code>fsetpos</code>, or <code>rewind</code>, or an input operation that encounters an end of file.</li>
</ul>
<h3 id="doubts-and-solutions">Doubts and Solutions</h3>
<h4 id="verbatim">Verbatim</h4>
<p>Section 5.4 on line buffering [p145]</p>
<blockquote>
<p>Second, whenever input is requested through the standard I/O library from either (a) an unbuffered stream or (b) a line-buffered stream (that requires data to be requested from the kernel), all line-buffered output streams are flushed. The reason for the qualifier on (b) is that the requested data may already be in the buffer, which doesn’t require data to be read from the kernel. Obviously, any input from an unbuffered stream, item (a), requires data to be obtained from the kernel.</p>
</blockquote></div>
        </div>

        

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>